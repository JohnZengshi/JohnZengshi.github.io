---
title: 关于跨域请求
categories: 开发技巧
---

>##  跨域请求

+ 在A域以ajax请求另外域的资源.是不被允许的.ajax只能请求本域的资源.无法发起跨域请求.
    - 解决方案：
    ```html
    方向代理
    服务器设置
    jsonp
    ```

+  关于script标签
    - 引入外部的js文件.script标签的src属性:将外部的js文件引入,并且将其中的代码执行.
    - script标签的src属性,可以请求任意类型的文件.
    - script标签的src属性天然支持跨域.
        - CDN: 内容分发网络.
        - libs:
               xxx  xx x xx x x x x x x x

+ jsonp的跨域原理
    - 就是利用script标签的src属性来完成的
    - 先在浏览器端准备一个函数(demo)这个函数有一个参数
    - 利用script标签的src属性.在请求的时候,要把我事先准备的函数的名字发给服务器.
        ```js
        <script src="./php/stus.php?callback=demo"></script>
        ```
    - 在服务器端
        - 先接受浏览器传递过来的函数的名称

        - 正常处理请求.

        - 返回数据的时候:要返回的格式: 函数名(真正的数据)

    - 当浏览器接收到服务器返回的数据的时候.,事先准备的函数就被执行了. 

+ jsonp的特点：
    - 必须要服务器支持才可以(必须服务器和浏览器互相配合才可以)

    - jsonp只支持get


>## 将跨域请求封装成一个函数：

```js
<script>
    var id = 1;
    function jsonp(opts){
        //1.拼接url
        var url = opts.url + "?";
        for(var key in opts.params){
            url += (key + "=" + opts.parms[key] + "&")

            //2.保存匿名函数
            //https://api.asilu.com/weather/?city=深圳&day=3&sb=4&callback=hmCallback
            //hmCallback(数据); 
        }

        var callbackName = "hmCallback" + (id++);
        //hmCallback1
        //window[hmCallback1] = opts.callback;

        window[callbackName] = opts.callback;
        url += "callback="+callbackName;
        consol.log(url);

        //3. 创建script标签.
        var script = document.createElement("script")
        script.src = url;
        document.body.appendChild(script);
    }


    function getW(){
        //调用封装好的jsonp函数发起跨域请求
        jsonp({
            url:"https://api.asilu.com/weather/",
            params:{
                city:"深圳",
                day:3,
                sb:4
            },
            calback:function(data){
                console.log(data)
            }
        })
    }
</script>
```