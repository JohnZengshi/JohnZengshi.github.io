{"title":"对AJAX的进一步理解","slug":"对AJAX的进一步理解","date":"2017-09-20T05:43:22.385Z","updated":"2017-09-20T07:24:15.967Z","comments":true,"excerpt":"","content":"<blockquote>\n<h2 id=\"AJAX\"><a href=\"#AJAX\" class=\"headerlink\" title=\"AJAX\"></a>AJAX</h2></blockquote>\n<ul>\n<li>是一种异步请求的技术.页面的局部刷新</li>\n<li><p>浏览器向服务器发送数据的时候.发送的数据是分格式的.</p>\n<ul>\n<li>当我们以get方式向服务器发送数据的时候,发送的数据的格式:Query String</li>\n<li>当我们以post方式向服务器发送数据的时候,发送的数据的格式默认是: Request Payload<ul>\n<li>如果我们以post方式向服务器发送数据,发送的数据的格式是Request Payload, 服务器绝大多数情况下不会解析接收，服务器会解析接收form data格式的数据.<br> 所以,为了服务器可以正常接收我们post过去的数据.<br> 我们就要将默认的Request Payload格式的数据转换为服务器认识的form data格式的.</li>\n</ul>\n</li>\n<li>如何转form data格式<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">xhr.setReauestHeader(<span class=\"string\">\"content-type\"</span>,<span class=\"string\">\"application/x-www-form-urlencoded\"</span>)</div><div class=\"line\"><span class=\"comment\">//将post方式发送的数据由默认的Request Payload格式转换为form data</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>总结：</p>\n<ul>\n<li>向服务器发送的数据是分格式的</li>\n<li>以get方式发送的数据的格式是:Query String服务器可以解析接收</li>\n<li>以post方式发送的数据,其格式默认是Request Payload服务器大多数情况下,是不会解析接收这种格式的.</li>\n<li>post接口如果没有做特殊说明,发送的数据的格式一定要转换成form data.</li>\n</ul>\n</li>\n<li><p>具体实现：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script&gt;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajaxGet</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//1.创建异步对象</span></div><div class=\"line\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XHLHttpRequest();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//2.设置请求的方式和资源的路径</span></div><div class=\"line\">        xhr.open(<span class=\"string\">\"get\"</span>,<span class=\"string\">\"./php/stus.php\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//3.注册事件</span></div><div class=\"line\">        xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            <span class=\"comment\">//当xhr异步对象已经拿到了服务器返回的数据</span></div><div class=\"line\">            <span class=\"comment\">//服务器正确处理</span></div><div class=\"line\">            <span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>)&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(xhr.responseText)</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//4.发送</span></div><div class=\"line\">        xhr.send();</div><div class=\"line\">    &#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajaxPost</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span>  XMLHttpRequest();</div><div class=\"line\">        xhr.open(<span class=\"string\">\"post\"</span>,<span class=\"string\">\"./php/stus.php\"</span>);</div><div class=\"line\">        <span class=\"comment\">//xhr异步对象向服务器请求数据的时候,它有四种状态</span></div><div class=\"line\">        <span class=\"comment\">//onreadystatechange 只要xhr的状态发生了改变就会触发.</span></div><div class=\"line\">        <span class=\"comment\">//准备发送  正在发送  正在接受  接受完成 4</span></div><div class=\"line\">        <span class=\"comment\">//每一种状态都有1个状态码.</span></div><div class=\"line\"></div><div class=\"line\">        xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>)&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(xhr.responseText);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        xhr.send();</div><div class=\"line\">    &#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajaxGetWithData</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">        xhr.open(<span class=\"string\">\"get\"</span>,<span class=\"string\">\"./php/get.php?name=jack&amp;age=18\"</span>);</div><div class=\"line\">        xhr.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(xhr.responseText);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//onload是1个事件: 当xhr的状态变为4的时候触发用了onload事件就不需要判断xhr.readyState == 4</span></div><div class=\"line\">        xhr.send();</div><div class=\"line\">    &#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajaxPostWithData</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">        xhr.open(<span class=\"string\">\"post\"</span>,<span class=\"string\">\"./php/post.php\"</span>)</div><div class=\"line\"></div><div class=\"line\">        xhr.setRequsetHeader(<span class=\"string\">\"content-type\"</span>,<span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</div><div class=\"line\"></div><div class=\"line\">        xhr.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(xhr.responseText);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;;</div><div class=\"line\">        xhr.send(<span class=\"string\">\"name=admin&amp;pwd=123456\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"ajaxGet()\"</span>&gt;</span>ajax纯get请求<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"ajaxPost()\"</span>&gt;</span>ajax纯post请求<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"ajaxGetWithData()\"</span>&gt;</span>get请求带数据<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"ajaxPostWthData()\"</span>&gt;</span>post请求带数据<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>还有一种改变数据格式的方法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"./php/xxx.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span> <span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"file\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n","categories":[],"tags":[{"name":"建站技巧","path":"api/tags/建站技巧.json"}]}