{"title":"关于跨域请求","slug":"关于跨域请求","date":"2017-09-20T13:46:08.196Z","updated":"2017-09-21T05:27:43.125Z","comments":true,"excerpt":"","content":"<blockquote>\n<h2 id=\"跨域请求\"><a href=\"#跨域请求\" class=\"headerlink\" title=\"跨域请求\"></a>跨域请求</h2></blockquote>\n<ul>\n<li><p>在A域以ajax请求另外域的资源.是不被允许的.ajax只能请求本域的资源.无法发起跨域请求.</p>\n<ul>\n<li>解决方案：<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">方向代理</div><div class=\"line\">服务器设置</div><div class=\"line\">jsonp</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>关于script标签</p>\n<ul>\n<li>引入外部的js文件.script标签的src属性:将外部的js文件引入,并且将其中的代码执行.</li>\n<li>script标签的src属性,可以请求任意类型的文件.</li>\n<li>script标签的src属性天然支持跨域.<ul>\n<li>CDN: 内容分发网络.</li>\n<li>libs:<pre><code>xxx  xx x xx x x x x x x x\n</code></pre></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>jsonp的跨域原理</p>\n<ul>\n<li>就是利用script标签的src属性来完成的</li>\n<li>先在浏览器端准备一个函数(demo)这个函数有一个参数</li>\n<li><p>利用script标签的src属性.在请求的时候,要把我事先准备的函数的名字发给服务器.</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">\"./php/stus.php?callback=demo\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n</li>\n<li><p>在服务器端</p>\n<ul>\n<li><p>先接受浏览器传递过来的函数的名称</p>\n</li>\n<li><p>正常处理请求.</p>\n</li>\n<li><p>返回数据的时候:要返回的格式: 函数名(真正的数据)</p>\n</li>\n</ul>\n</li>\n<li><p>当浏览器接收到服务器返回的数据的时候.,事先准备的函数就被执行了. </p>\n</li>\n</ul>\n</li>\n<li><p>jsonp的特点：</p>\n<ul>\n<li><p>必须要服务器支持才可以(必须服务器和浏览器互相配合才可以)</p>\n</li>\n<li><p>jsonp只支持get</p>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<h2 id=\"将跨域请求封装成一个函数：\"><a href=\"#将跨域请求封装成一个函数：\" class=\"headerlink\" title=\"将跨域请求封装成一个函数：\"></a>将跨域请求封装成一个函数：</h2></blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script&gt;</div><div class=\"line\">    <span class=\"keyword\">var</span> id = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jsonp</span>(<span class=\"params\">opts</span>)</span>&#123;</div><div class=\"line\">        <span class=\"comment\">//1.拼接url</span></div><div class=\"line\">        <span class=\"keyword\">var</span> url = opts.url + <span class=\"string\">\"?\"</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> opts.params)&#123;</div><div class=\"line\">            url += (key + <span class=\"string\">\"=\"</span> + opts.parms[key] + <span class=\"string\">\"&amp;\"</span>)</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//2.保存匿名函数</span></div><div class=\"line\">            <span class=\"comment\">//https://api.asilu.com/weather/?city=深圳&amp;day=3&amp;sb=4&amp;callback=hmCallback</span></div><div class=\"line\">            <span class=\"comment\">//hmCallback(数据); </span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> callbackName = <span class=\"string\">\"hmCallback\"</span> + (id++);</div><div class=\"line\">        <span class=\"comment\">//hmCallback1</span></div><div class=\"line\">        <span class=\"comment\">//window[hmCallback1] = opts.callback;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"built_in\">window</span>[callbackName] = opts.callback;</div><div class=\"line\">        url += <span class=\"string\">\"callback=\"</span>+callbackName;</div><div class=\"line\">        consol.log(url);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//3. 创建script标签.</span></div><div class=\"line\">        <span class=\"keyword\">var</span> script = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"script\"</span>)</div><div class=\"line\">        script.src = url;</div><div class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(script);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">        <span class=\"comment\">//调用封装好的jsonp函数发起跨域请求</span></div><div class=\"line\">        jsonp(&#123;</div><div class=\"line\">            url:<span class=\"string\">\"https://api.asilu.com/weather/\"</span>,</div><div class=\"line\">            params:&#123;</div><div class=\"line\">                city:<span class=\"string\">\"深圳\"</span>,</div><div class=\"line\">                day:<span class=\"number\">3</span>,</div><div class=\"line\">                sb:<span class=\"number\">4</span></div><div class=\"line\">            &#125;,</div><div class=\"line\">            calback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;)</div><div class=\"line\">    &#125;</div><div class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></div></pre></td></tr></table></figure>","categories":[{"name":"开发技巧","path":"api/categories/开发技巧.json"}],"tags":[]}