{"title":"AngularJS中的$http服务","slug":"AngularJS中的$http服务","date":"2017-09-20T07:28:26.008Z","updated":"2017-09-20T14:11:47.974Z","comments":true,"excerpt":"","content":"<blockquote>\n<h2 id=\"AngularJS中的-http服务\"><a href=\"#AngularJS中的-http服务\" class=\"headerlink\" title=\"AngularJS中的$http服务\"></a>AngularJS中的$http服务</h2></blockquote>\n<ul>\n<li><p>$http服务,ng封装的一个ajax请求工具.</p>\n</li>\n<li><p>使用$http服务.</p>\n  <figure class=\"highlight js\"><div class=\"mdui-table-fluid\"><table class=\"mdui-table mdui-table-hoverable \"><tr><td class=\"code\"><pre><div class=\"line\">$http(&#123;</div><div class=\"line\">    <span class=\"comment\">//一个对象</span></div><div class=\"line\">    <span class=\"comment\">//通过对象的键值对来指定请求的参数</span></div><div class=\"line\"></div><div class=\"line\">    url:  <span class=\"comment\">//指定要请求的资源的路径.</span></div><div class=\"line\">    method:  <span class=\"comment\">//指定请求的方式 get/post 默认是get</span></div><div class=\"line\">    params: &#123;&#125;  <span class=\"comment\">//当请求方式是get的时候,发送的数据要以键值对的形式存储在这个对象中.</span></div><div class=\"line\">    data: <span class=\"string\">\"\"</span> <span class=\"comment\">//字符串. 当请求的方式是post的时候,发送的数据要存储在这个属性中.</span></div><div class=\"line\">    headers: &#123;&#125;  <span class=\"comment\">//设置请求头.转换formData格式</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//当请求方式是post的时候,发送的数据的格式ng底层并没有帮我们转换,所以,需要我们手动的加请求头转换formData格式</span></div><div class=\"line\">&#125;)</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//通过链式编程的方式点1个then方法出来.</span></div><div class=\"line\">    <span class=\"number\">1.</span>传入两个回调.</div><div class=\"line\">    <span class=\"number\">2.</span>第<span class=\"number\">1</span>个回调:在请求成功的时候执行. 有<span class=\"number\">1</span>个参数(response)</div><div class=\"line\">    <span class=\"number\">3.</span>response 代表服务器返回的数据。</div><div class=\"line\">    <span class=\"number\">4.</span>response.data可以拿到服务器返回的真正的数据.</div><div class=\"line\">    <span class=\"number\">5.</span>第<span class=\"number\">2</span>个回调:在请求失败的时候执行.</div></pre></td></tr></table></div></figure>\n</li>\n<li><p>具体实现：</p>\n  <figure class=\"highlight js\"><div class=\"mdui-table-fluid\"><table class=\"mdui-table mdui-table-hoverable \"><tr><td class=\"code\"><pre><div class=\"line\">&lt;script&gt;</div><div class=\"line\">    <span class=\"keyword\">var</span> app = angular.module(<span class=\"string\">\"hmApp\"</span>,[]);</div><div class=\"line\">    app.controller(<span class=\"string\">\"hmCtrl\"</span>,[<span class=\"string\">\"$scope\"</span>,<span class=\"string\">\"$http\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$scope,$http</span>)</span>&#123;</div><div class=\"line\">        $scope.httpGet = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            $http(&#123;</div><div class=\"line\">                url:<span class=\"string\">\"./php/xxx.php\"</span>,</div><div class=\"line\">                method:<span class=\"string\">\"get\"</span>,</div><div class=\"line\">            &#125;.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(response.data)</div><div class=\"line\">            &#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"error!\"</span>)</div><div class=\"line\">            &#125;))</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//不带数据Get请求</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        $scope.httpPost = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            $http(&#123;</div><div class=\"line\">                url:<span class=\"string\">\"./php/xxx.php\"</span>,</div><div class=\"line\">                method:<span class=\"string\">\"post\"</span>,</div><div class=\"line\">            &#125;.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(respon.data)</div><div class=\"line\">            &#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"error!\"</span>)</div><div class=\"line\">            &#125;))</div><div class=\"line\">            </div><div class=\"line\">            <span class=\"comment\">//不带数据post请求</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        $scope.httpGetWithData = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            $http(&#123;</div><div class=\"line\">                url:<span class=\"string\">\"./php/xxx.php\"</span>,</div><div class=\"line\">                method:<span class=\"string\">\"get\"</span>,</div><div class=\"line\">                params:&#123;</div><div class=\"line\">                    name:<span class=\"string\">\"jack\"</span>,</div><div class=\"line\">                    pwd:<span class=\"string\">\"123456\"</span></div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(response.data)</div><div class=\"line\">            &#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"error!\"</span>)</div><div class=\"line\">            &#125;))</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//带数据Get请求发送</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        $scope.httpPostWithData = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">            $http(&#123;</div><div class=\"line\">                url:<span class=\"string\">\"./php/xxx.php\"</span>,</div><div class=\"line\">                method:<span class=\"string\">\"post\"</span>,</div><div class=\"line\">                data:<span class=\"string\">\"?name='jack'&amp;pwd=1234\"</span>,</div><div class=\"line\">                headers:&#123;</div><div class=\"line\">                    <span class=\"string\">\"Content-Type\"</span>:<span class=\"string\">\"application/x-www-form-urlencoded\"</span></div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;.then(funciton(response)&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(response.data)</div><div class=\"line\">            &#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"error!\"</span>)</div><div class=\"line\">            &#125;))</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//带数据post请求发送</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;])</div><div class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></div></pre></td></tr></table></div></figure>\n</li>\n<li><p>利用$http进行跨域请求：</p>\n<ul>\n<li>只需要将method设置为jsonp就可以</li>\n<li>在发起跨域之前，需要设置一个白名单<figure class=\"highlight html\"><div class=\"mdui-table-fluid\"><table class=\"mdui-table mdui-table-hoverable \"><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">ng-app</span>=<span class=\"string\">\"hmApp\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"demoCtrl\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> app = angular.module(<span class=\"string\">\"hmApp\"</span>, []);</span></div><div class=\"line\"><span class=\"javascript\">        app.config([<span class=\"string\">'$sceDelegateProvider'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$sceDelegateProvider</span>) </span>&#123;</span></div><div class=\"line\"><span class=\"undefined\">            </span></div><div class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// 设置跨域白名单</span></span></div><div class=\"line\"><span class=\"javascript\">            $sceDelegateProvider.resourceUrlWhitelist([<span class=\"string\">\"https://api.asilu.com/weather/\"</span>]);</span></div><div class=\"line\"><span class=\"undefined\">        &#125;])</span></div><div class=\"line\"><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">        app.controller(<span class=\"string\">\"demoCtrl\"</span>, [<span class=\"string\">\"$scope\"</span>, <span class=\"string\">\"$http\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$scope, $http</span>) </span>&#123;</span></div><div class=\"line\"><span class=\"undefined\">            $http(&#123;</span></div><div class=\"line\"><span class=\"javascript\">                url: <span class=\"string\">\"https://api.asilu.com/weather/\"</span>,</span></div><div class=\"line\"><span class=\"undefined\">                params: &#123;</span></div><div class=\"line\"><span class=\"javascript\">                    city: <span class=\"string\">\"深圳\"</span></span></div><div class=\"line\"><span class=\"undefined\">                &#125;,</span></div><div class=\"line\"><span class=\"javascript\">                method: <span class=\"string\">\"jsonp\"</span></span></div><div class=\"line\"><span class=\"javascript\">            &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">console</span>.log(response.data);</span></div><div class=\"line\"><span class=\"undefined\">            &#125;);</span></div><div class=\"line\"><span class=\"undefined\">        &#125;]);</span></div><div class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div></pre></td></tr></table></div></figure></li>\n</ul>\n</li>\n</ul>\n","categories":[],"tags":[]}